<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/libs/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/libs/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Leaf Photo, iOS" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Alicia's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Alicia's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Alicia's Blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6267334170712737000,
      author: 'Alicia'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Alicia's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?cbbd9aa76d6f5e7b8019ca96dba4e7e2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Alicia's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">［LEAF Photo］作者</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/07/An-Organic-Problem-Solving-Approach/" itemprop="url">
                  An Organic Problem Solving Approach
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-08-07T21:25:51+08:00" content="2017-08-07">
              2017-08-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>《成为技术领导者：掌握全面解决问题的方法》这本书读了两遍，第一遍是从网上下的一个早期的 PDF 版本内容不全，并且很多地方翻译晦涩，所以又买了正版的纸质书进行了二刷。纸质书是完整版，但是翻译依然晦涩，主要是因为作者大量使用比喻或者多义词，所以太考验翻译者的能力了。另外书名又是出版社为了讨好国人而起，副标题才是作者原书名，但是我不喜欢译者的很多措辞，我觉得书名应该是《解决问题的系统方法》。</p>
<p>这本书介绍了很多解决问题的方式，以及如何获得领导力，并不是刻意在说如何当好领导者，即不是领导者的人依然可以从中有所收获。作为领导者，我们不应该因为自己是领导而把自己的位置放的高高在上而不去为他人着想；作为非领导者，我们也要替领导者思考，不想做将军的士兵不是好厨子嘛。</p>
<h2 id="领导模型"><a href="#领导模型" class="headerlink" title="领导模型"></a>领导模型</h2><p>作者提出了领导力的 MOI 模型，即 激励（Motivation），组织（Organization），想法和创新（ideas or innovation）。</p>
<p>激励：领导者要做的事情是激励他人更好的完成工作任务。</p>
<p>激励的方式有很多种，中国父母最爱用的激励方式就是夸别人家的孩子怎么优秀，要不就是怎么都看不上自己家的孩子，觉得他们只要学习不好就一无是处。领导管理下属的方式也是一样，差劲的领导经常是在夸别的部门员工怎么好，自己手下的员工多么差劲，对员工的优点视而不见，小小的缺点都无法忍受。</p>
<p>我们不应该用打击的方式去激励他人，这种方式只适合那些心里强大并且很有上进心的下属，对于大部分人来说这种方法很不受用，尤其是在你并非是下属父母的情况下，下属很可能被你这么“激励”几次就会辞职不干了。</p>
<p>组织：领导者要做的事情是创造一个环境，让每个人都能发挥更多的能力。</p>
<p>想法和创新：应当具备创新意识、并且能够接受他人想法。</p>
<h2 id="解决问题的方式"><a href="#解决问题的方式" class="headerlink" title="解决问题的方式"></a>解决问题的方式</h2><p>本书是介绍解决问题的方式的，作者认为遇到问题应当从以下几个方面着手</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/08/07/An-Organic-Problem-Solving-Approach/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/31/Optimize-App-Performance/" itemprop="url">
                  Optimize App Performance
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-07-31T22:25:28+08:00" content="2017-07-31">
              2017-07-31
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>之前写过一篇关于性能的文章，最近又需要优化性能，所以在此基础上写一篇最近的优化总结</p>
<p>性能优化的几个方面：内存问题、电量消耗、启动时间、执行与响应速度、网络条件等等，下面就从这几个方面讨论下如何优化</p>
<h3 id="内存问题"><a href="#内存问题" class="headerlink" title="内存问题"></a>内存问题</h3><p>可借助工具：Instruments -&gt; Leaks / Allocations / Zombies</p>
<p>内存问题，主要包括避免内存泄漏（使用 ARC，Block 中使用变量不要循环引用，可以借鉴以前的文章）、及时释放可以释放的无用内存（例如在一个循环中处理图片，可以使用自动释放池）</p>
<h3 id="电量消耗"><a href="#电量消耗" class="headerlink" title="电量消耗"></a>电量消耗</h3><p>可借助工具：Instruments -&gt; Energy Log</p>
<p>当 CPU 占用率较高，使用网络/GPS 等情况下，电量会消耗较快。</p>
<p>降低 CPU 使用率的方式是优化代码中的算法，能使用系统 API 的尽量使用系统 API，这要求我们对不常用的 API 要有所了解，另外多看别人的源代码，对于不了解的 API 要查询下用法，算法方面，除了好脑子就要靠平时多看算法类的书籍锻炼了。</p>
<p>网络问题见下详述</p>
<p>GPS检查，设置合适的处理精度和距离，使用合适的 API 来更新位置。</p>
<p>例如在非实时（追踪走路等）定位的场景下，调用如下方法延时获取数据</p>
<pre><code>[locationManager allowDeferredLocationUpdatesUntilTraveled:timeout:]
</code></pre><p>或者位置有重大变化（天气应用）时才需要获取数据，调用如下方法</p>
<pre><code>[locationManager startMonitoringSignificantLocationChanges]
</code></pre><p>再或者使用区域检测</p>
<pre><code>[locationManager startMonitoringForRegion:]
</code></pre><h3 id="启动时间"><a href="#启动时间" class="headerlink" title="启动时间"></a>启动时间</h3><p>见<a href="http://alicialy.github.io/2017/02/22/Optimize-App-Startup-Time/">另一篇文章</a></p>
<h3 id="执行与响应速度"><a href="#执行与响应速度" class="headerlink" title="执行与响应速度"></a>执行与响应速度</h3><p>可借助工具：Instruments -&gt; Time Profiler</p>
<p>通过 Time Profiler 可以找到调用时间较长的 API，对消耗时间较长的代码进行优化，找到可优化代码只是第一步，比较困难的可能是如何优化，下面就几个方面讨论下优化途径</p>
<h5 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h5>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/07/31/Optimize-App-Performance/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/07/iOS-App-Thinning/" itemprop="url">
                  iOS App Thinning
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-04-07T20:55:05+08:00" content="2017-04-07">
              2017-04-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="图片资源删减"><a href="#图片资源删减" class="headerlink" title="图片资源删减"></a>图片资源删减</h3><h5 id="使用工具查找未引用资源"><a href="#使用工具查找未引用资源" class="headerlink" title="使用工具查找未引用资源"></a>使用工具查找未引用资源</h5><p><a href="https://github.com/tinymind/LSUnusedResources/" target="_blank" rel="external">LSUnusedResources</a> 比之前的 Unused 好用，对于大型工程来说 Unused 效率太低</p>
<h5 id="压缩-PNG"><a href="#压缩-PNG" class="headerlink" title="压缩 PNG"></a>压缩 PNG</h5><p>按照文件大小排列，看看是否有上百 K 的 PNG 图片，使用工具进行压缩，可以使用 JPG 的不要用 PNG</p>
<p>大图片不要使用 PNG，用 JPG 替换</p>
<p>删除掉 1x 图片</p>
<h3 id="代码精简"><a href="#代码精简" class="headerlink" title="代码精简"></a>代码精简</h3><h5 id="查找无用的-OC-类"><a href="#查找无用的-OC-类" class="headerlink" title="查找无用的 OC 类"></a>查找无用的 OC 类</h5><p>维护时间较长的代码，可能会出现废弃的类出现在代码中，这种无用的文件比较难找，可以通过 linkMap 文件来分析。</p>
<p>设置 Project -&gt; Build Settings -&gt; Write Link Map File 为 YES，并设置 Path to Link Map File，build 完后找到 linkMap 文件，来分析该文件，该文件默认位于</p>
<p>~/Library/Developer/Xcode/DerivedData/XXX-eumsvrzbvgfofvbfsoqokmjprvuh/Build/Intermediates/XXX.build/Debug-iphoneos/XXX.build/</p>
<p>该文件的介绍，可以参考下 <a href="http://blog.cnbang.net/tech/2296/" target="_blank" rel="external">这里</a></p>
<p>在 bang 同学的脚本基础上作了改进，原脚本支持第三方库大小统计，在该脚本的基础上，添加了分析 objc-class-ref 段，查找未引用的类的方法，代码<a href="https://github.com/alicialy/LTAppThinningScript" target="_blank" rel="external">点击这里</a></p>
<h5 id="查找无用的函数"><a href="#查找无用的函数" class="headerlink" title="查找无用的函数"></a>查找无用的函数</h5><p>无用函数，可能是暂时无用，或者不确定是否以后会用到的，可以通过工具来查找无用函数，<a href="https://github.com/ming1016/SMCheckProject" target="_blank" rel="external">推荐工具点这里</a></p>
<p>或者按照查找无用 OC 类的方式写脚本分析 selrefs 段</p>
<h5 id="编译选项优化"><a href="#编译选项优化" class="headerlink" title="编译选项优化"></a>编译选项优化</h5><p>Strip Link Product 是否为 YES<br>Make Strings Read-Only 是否 为YES<br>去掉异常支持，Enable C++ Exceptions 和 Enable Objective-C Exceptions 设为 NO，并且Other C Flags 添加 -fno-exceptions </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/22/Optimize-App-Startup-Time/" itemprop="url">
                  Optimize App Startup Time
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-02-22T08:10:45+08:00" content="2017-02-22">
              2017-02-22
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>启动时间包括 main 执行之前的时间，以及 main 执行之后的时间。</p>
<p>main 执行之后的时间通过 Time Profiler 查看即可，之前写过文章，<a href="http://alicialy.github.io/2016/03/30/What-I-Talk-About-When-I-Talk-About-Performance/">详情点击这里</a>。</p>
<p>这篇文章主要讨论 main 执行之前的时间。</p>
<h3 id="main-之前-的加载过程"><a href="#main-之前-的加载过程" class="headerlink" title="main 之前 的加载过程"></a>main 之前 的加载过程</h3><p>Load dylibs =&gt; Rebase =&gt; Binding =&gt; ObjC =&gt; Initializers</p>
<p>在 Xcode 中 Edit scheme -&gt; Run -&gt; Auguments 中设置 DYLD_PRINT_STATICS 环境变量可以输出 main 之前执行的时间</p>
<h3 id="Load-dylibs"><a href="#Load-dylibs" class="headerlink" title="Load dylibs"></a>Load dylibs</h3><p>要了解第一个阶段的 dylibs，先要介绍下 OS X 的可执行文件 Mach-O</p>
<p>Mach-O 二进制格式</p>
<p>系统判断一个文件是否可以执行，是通过将文件读入内存，然后寻找一个头签名，头签名通常被称为 魔数 magic，通过 magic 可以判断文件的二进制格式，如果是被支持的二进制格式，那么就可以执行该文件。</p>
<p>在很多种可执行文件格式中， OS X 目前只支持：解释器脚本格式、通用二进制格式以及 Mach-O 格式。Mach-Object，简称 Mach-O，是苹果在 OS X 中维护的一种独有的二进制格式。</p>
<p>Mach-O 的文件头 mach_header 中包含magic、CPU 类型和子类型等。mach_header 其后包含了很多指令，这些指令被调用时清晰地指导了如何设置并加载二进制数据，这些指令被称为“加载指令”。加载指令包括将文件中的段映射到进程地址空间、调用 dyld、开启线程、代码签名等。</p>
<p>OS X 上几乎所有的程序都是动态链接的，仅有非常少量的进程只需要内核加载起就可以完成加载。通常情况下，使用 dyld 作为动态连接器。</p>
<p>Loading Dylibs 的加载过程又分为</p>
<p>Parse list of dependent dylibs =&gt; Find requested mach-o file =&gt; Open and read start of file =&gt; Validate mach-o =&gt; Register code signature =&gt; Call mmap() for each segment</p>
<p>上面说过 mach_header 中包含很多指令，其中包含了 LC_CODE_SIGNATURE 用于数字签名，iOS 强制要求代码签名，且代码签名和沙盒机制是绑定在一起的，也就是说必须放到沙盒中经过签名才能运行，非越狱的机器无法自行下载一个动态库并执行。</p>
<p>mmap的作用是将一个文件或者其他对象映射进内存，普通文件被映射到进程地址空间后，进程可以像访问普通内存一样对文件进行访问。</p>
<p>通常一个 App 需要加载 100 - 400 个 dylibs，但是其中的系统库加载会被优化，能在很快的时间内加载完成</p>
<h5 id="优化-Load-dylibs-过程"><a href="#优化-Load-dylibs-过程" class="headerlink" title="优化 Load dylibs 过程"></a>优化 Load dylibs 过程</h5>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/02/22/Optimize-App-Startup-Time/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/31/2016-book-list/" itemprop="url">
                  2016 book list
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-31T20:00:30+08:00" content="2016-12-31">
              2016-12-31
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这一年，看过的工作类图书如下：</p>
<blockquote>
<p>乔布斯的魔力演讲</p>
</blockquote>
<p>即使看过乔布斯演讲的人看看这书也能有所收获。</p>
<blockquote>
<p>不懂带人你就自己干到死</p>
</blockquote>
<p>看完后写过一篇文章，<a href="http://alicialy.github.io/2016/08/31/Reading-The-Solution-Tango/" target="_blank" rel="external">感兴趣点这里</a></p>
<blockquote>
<p>软技能代码之外的生存之道</p>
</blockquote>
<p>书中很多东西可能对于一个老程序员来说，早已领悟，看看无妨。对番茄工作法用来估测自己工作时间的方式感觉很有用处，即当你被分配一个任务时，需要预估做完这个工作需要多少时间，可以先预估大致需要几个番茄时间，之后用一个番茄时间 20 分钟去完成，看看进度是多少，然后重新预估的时间一半比较准确。例如预估 8 个 番茄时间能完成的工作，实际工作 1 个番茄时间后发现工作只完成了 1/16，那么预估时间大约就是 16 个番茄时间，这个时间更准确些。</p>
<blockquote>
<p>Learning React Native</p>
</blockquote>
<p>一边看官方文档，一般看这本书写个 Demo，能对 RN 所有类的用法有个基本掌握。</p>
<blockquote>
<p>Design Code </p>
</blockquote>
<p>Design 方面讲的还是不错，还介绍了 Sketch 的用法，但是 Code 方面应该只是对刚入门的程序员来说可能又用，所以没有仔细看。</p>
<blockquote>
<p>Git 版本控制管理</p>
</blockquote>
<p>不只是 Git 的一本不错的工具书，还介绍了一点原理</p>
<blockquote>
<p>iOS 测试指南</p>
</blockquote>
<p>稍微有些过时，对于平时感觉没有那么有用，有空会再看看</p>
<blockquote>
<p>写给大忙人看的 Swift</p>
</blockquote>
<p>太简约了，感觉如果真的忙的没有时间，那看官方的手册前几页就可以了，没有必要看这本书。</p>
<blockquote>
<p>Mac OS X and iOS Internals</p>
</blockquote>
<p>对系统底层非常详细的介绍，但是稍微有些太理论，所以有些枯燥，没有那么容易一气呵成的读完，仍然值得一看。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/About-Message-send-to-dealloc-instance/" itemprop="url">
                  About Message send to dealloc instance
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-11-17T21:43:04+08:00" content="2016-11-17">
              2016-11-17
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近，遇到一个崩溃问题，崩溃前控制台打印出 “message send to dealloc instance”，在解决问题的过程中发现一个调试工具。</p>
<p>话说，这一次的问题主要是发生在 MRC 环境下，除了发现调试工具，还回忆了一下 MRC。感兴趣的话，可以当作面试题来看看下面代码有什么问题。</p>
<p>上一次用到 MRC 恐怕还是 2011 年，这次是因为公司有个老代码使用的是很早以前别人写的库，一直没有升级所以还是在 MRC 下。先来描述下问题。</p>
<h3 id="崩溃代码"><a href="#崩溃代码" class="headerlink" title="崩溃代码"></a>崩溃代码</h3><p>重要的事情说三遍，MRC 下，MRC 下，MRC 下</p>
<pre><code>//.h 头文件中定义了一个变量
NSString *_title;
//.m 实现文件中
- (id)initWithTitle:(NSString *)title {
    _title = [title copy];
    // … 
}
- (void)dealloc  {
    [_title release];
    [super dealloc];
}
// 另一个调用文件中是这样子的
[[xxClass alloc] initWithTitle:nil];
</code></pre><p>最近的一次修改导致崩溃是被改成了下面的样子，当 title 为 nil 时把它定义为默认字符串，于是上面的 initWithTitle 改为</p>
<pre><code>- (id)initWithTitle:(NSString *)title {
    if (title) {
        _title = [title copy];
    } else {
        _title = NSLocalizedString(@&quot;提示&quot;, nil);
    }
}
</code></pre><p>接下来的事情是这样的，某个页面在多次调用 initWithTitle 的时候会发生崩溃，错误信息是这样子的：</p>
<pre><code>UncaughtExceptionHandlerAddressesKey = (
4   CoreFoundation                      0x1b9ca81c &lt;redacted&gt; + 2124,
5   CoreFoundation                      0x1b9c9f8f CFDictionaryGetValue + 126,
6   CoreFoundation                      0x1bb1446b &lt;redacted&gt; + 142,
7   CoreFoundation                      0x1bb14111 CFBundleCopyLocalizedStringForLocalization + 94,
8   CoreFoundation                      0x1ba0f6bb CFBundleCopyLocalizedString + 18,
</code></pre><p>调试的话，崩溃的位置就在 _title = NSLocalizedString(@”提示”, nil); 这一行。</p>
<p>不知道各位看官是否一眼发现了问题，控制台还有这样的输出</p>
<p>message sent to deallocated instance 0x6d564f0</p>
<p>一时没想到 NSLocalizedString 会有什么问题，因为好久不用 MRC，武功已经全废，所以关注上了这个 message sent to deallocated instance，想通过这条信息查找到问题。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/11/17/About-Message-send-to-dealloc-instance/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/11/Source-Code-Learning-JDStatusBarNotification/" itemprop="url">
                  Source Code Learning JDStatusBarNotification
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-11T19:41:33+08:00" content="2016-10-11">
              2016-10-11
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="RunLoop-和-NSTimer"><a href="#RunLoop-和-NSTimer" class="headerlink" title="RunLoop 和 NSTimer"></a>RunLoop 和 NSTimer</h3><p>每次显示时先要将之前设置过的 timer 取消</p>
<pre><code>// cancel previous dismissing &amp; remove animations
[[NSRunLoop currentRunLoop] cancelPerformSelector:@selector(dismiss) target:self argument:nil];
</code></pre><p>timer 的设置代码如下：</p>
<pre><code>- (void)setDismissTimerWithInterval:(NSTimeInterval)interval; {
    [self.dismissTimer invalidate];             // 重新赋值时先要使其无效
    self.dismissTimer = [[NSTimer alloc] initWithFireDate:[NSDate dateWithTimeIntervalSinceNow:interval]
                                             interval:0 target:self selector:@selector(dismiss:) userInfo:nil repeats:NO];
    [[NSRunLoop currentRunLoop] addTimer:self.dismissTimer forMode:NSRunLoopCommonModes];
}
</code></pre><p>为了能在用户拖拽页面的时候 timer 正确计时，将 timer 添加到 NSRunLoopCommonModes 模式下</p>
<h3 id="UIWindowLevel"><a href="#UIWindowLevel" class="headerlink" title="UIWindowLevel"></a>UIWindowLevel</h3><p>每个应用都有一个主 window，通常在 AppDelegate 中设置</p>
<pre><code>self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
self.window.backgroundColor = [UIColor whiteColor];
self.window.rootViewController = [[UINavigationController alloc] initWithRootViewController:
                                  [[SBExampleViewController alloc] initWithStyle:UITableViewStyleGrouped]];

[self.window makeKeyAndVisible];
</code></pre><p>makeKeyAndVisible 方法是将某个 window 设置为主窗口并设置为可见，这个窗口的级别使用默认值 UIWindowLevelNormal，UIWindowLevel 的级别如下</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/10/11/Source-Code-Learning-JDStatusBarNotification/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/23/Clang-Attributes-in-Open-Source/" itemprop="url">
                  Clang Attributes in Open Source
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-23T19:37:56+08:00" content="2016-09-23">
              2016-09-23
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇文章应该叫做那些开源项目中用到过的 Clang Attributes，会列出开源项目的名字和使用方式以及用例</p>
<h3 id="visibility"><a href="#visibility" class="headerlink" title="visibility"></a>visibility</h3><h5 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h5><p><strong>attribute</strong> ((visibility(“default”)))</p>
<p>visibility 中的值可以为 default | internal | hidden | protected</p>
<p>该属性用于设置动态链接库中函数或者变量的可见性</p>
<p>我们在 C 语言中，如果想要将函数或变量限制在当前文件中，可以使用 static 关键字，但是在复杂的项目中，如果想要限制某个符号被共享库内部某些文件可以访问，而外部不可以访问泽有些困难，于是 GCC 中引入了 visibility 属性，它可以设置某个函数或变量是否可访问，例如这个变量在多个文件中被定义，又同时有多个链接库需要引用它时，如果不设置可见性，那么到底引用为那个值或者函数就要看加载顺序了。</p>
<h5 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h5><pre><code>UIKIT_EXTERN const UIWindowLevel UIWindowLevelNormal;
UIKIT_EXTERN const UIWindowLevel UIWindowLevelAlert;
UIKIT_EXTERN const UIWindowLevel UIWindowLevelStatusBar __TVOS_PROHIBITED;

#ifdef __cplusplus
#define UIKIT_EXTERN        extern &quot;C&quot; __attribute__((visibility (&quot;default&quot;)))
#else
#define UIKIT_EXTERN            extern __attribute__((visibility (&quot;default&quot;)))
#endif
</code></pre><h5 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h5><p>JDStatusBarNotification</p>
<h5 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h5><p><a href="https://gcc.gnu.org/onlinedocs/gcc-4.3.5/gcc/Function-Attributes.html" target="_blank" rel="external">Visibility Pragmas</a><br><a href="https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/CppRuntimeEnv/Articles/SymbolVisibility.html" target="_blank" rel="external">Controlling Symbol Visibility</a></p>
<h3 id="objc-subclassing-restricted"><a href="#objc-subclassing-restricted" class="headerlink" title="objc_subclassing_restricted"></a>objc_subclassing_restricted</h3><h5 id="解释-1"><a href="#解释-1" class="headerlink" title="解释"></a>解释</h5><pre><code>__attribute__((objc_subclassing_restricted))
</code></pre><p>用于限制某个类是不可继承的，但是这个限制只是编译时的限制，不直接写 @interface SubClass : ParentClass，而是使用 Runtime 的方式仍然是可以创建继承关系的。</p>
<pre><code>void run(id self, SEL _cmd) {}
class subClass = objc_allocateClassPair([ParentClass class], &quot;SubClass&quot;, 0);
class_addMethod(subClass, @selector(run),(IMP) run, &quot;v@:&quot;);
objc_registerClassPair(subClass);
</code></pre><h5 id="用例-1"><a href="#用例-1" class="headerlink" title="用例"></a>用例</h5><p><strong>attribute</strong>((objc_subclassing_restricted))<br>@interface ParentClass : NSObject<br>@end<br>@interface SubClass : ParentClass // &lt;— Compile Error<br>@end</p>
<h5 id="参考文献-1"><a href="#参考文献-1" class="headerlink" title="参考文献"></a>参考文献</h5><p><a href="http://blog.sunnyxx.com/2016/05/14/clang-attributes/" target="_blank" rel="external">Clang Attributes 黑魔法小记</a></p>
<h3 id="deprecated"><a href="#deprecated" class="headerlink" title="deprecated"></a>deprecated</h3><h5 id="解释-2"><a href="#解释-2" class="headerlink" title="解释"></a>解释</h5><pre><code>__attribute__((deprecated(&quot;弃用解释说明&quot;)));
</code></pre><p>用于说明某个属性已经弃用</p>
<p>@property (assign, nonatomic) CGFloat opacity <strong>attribute</strong>((deprecated(“Customize bezelView properties instead.”)));</p>
<h5 id="用例-2"><a href="#用例-2" class="headerlink" title="用例"></a>用例</h5><p>另外，忽略弃用警告可以使用</p>
<pre><code>#pragma clang diagnostic push
#pragma clang diagnostic ignored &quot;-Wdeprecated-declarations&quot;
self.bezelView.alpha = self.opacity;
#pragma clang diagnostic pop
</code></pre><h5 id="项目-1"><a href="#项目-1" class="headerlink" title="项目"></a>项目</h5><p>MBProgress</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/05/Writing-Crash-Free-Code/" itemprop="url">
                  Writing Crash-Free Code
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-05T17:03:07+08:00" content="2016-09-05">
              2016-09-05
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>面试的时候经常会被问到“程序崩溃都有哪些原因造成”，突然想的话想不到那么全面， 总结一下以备不时之需，也可以在写代码时注意下。另外，“如何处理崩溃”也是面试官喜欢问的问题，也做个总结。</p>
<h3 id="程序崩溃都有哪些原因造成"><a href="#程序崩溃都有哪些原因造成" class="headerlink" title="程序崩溃都有哪些原因造成"></a>程序崩溃都有哪些原因造成</h3><ul>
<li>可变数组的操作<ol>
<li>使用 (for in) 或迭代器遍历可变数组时删除数组元素，改为逆序遍历或者添加个数组副本</li>
<li>可变数组声明属性为 copy<br> // .h 文件<br> @property (nonatomic, copy) NSMutableArray <em>mutableArray;<br> // .m 文件<br> NSMutableArray </em>array = @[@1,@2];<br> self.mutableArray = array;<br> // 下句崩溃，因为 NSArray 中找不到 removeObjectAtIndex 方法<br> [self.mutableArray removeObjectAtIndex:0];  </li>
</ol>
</li>
<li>NSNotification addObserver 使用后没有（在 dealloc 中） removeObserver，或者 delegate 使用后没有置为 nil</li>
<li>多线程中访问同一块资源时，没有为数据加锁，数据错误可能会导致崩溃。另外在多线程中，UI 等操作需要放到主线程操作，否则会导致崩溃</li>
<li>操作野指针，或者对空进行操作，可以使用 NSParameterAssert 等进行判断</li>
<li>数组越界</li>
<li>调用对象不存在的方法</li>
<li>低内存终止，看门狗结束程序，大多是内存泄漏等导致。</li>
</ul>
<h3 id="修复线上崩溃的方法"><a href="#修复线上崩溃的方法" class="headerlink" title="修复线上崩溃的方法"></a>修复线上崩溃的方法</h3>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/09/05/Writing-Crash-Free-Code/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/31/Reading-The-Solution-Tango/" itemprop="url">
                  Reading The Solution Tango
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-31T20:14:15+08:00" content="2016-08-31">
              2016-08-31
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最近读了一本不错的管理类书籍，《The Solution Tango: Solving any problem in senven easy steps》 译者可能也知道这个英文名字估计不能吸引中国读者，所以他的中文译名是意译的 《不懂带人，你就自己干到死：把身边的庸才变干将》。</p>
<p>做技术的人大多跟机器打交道，并不擅长处理人的关系。当从做技术升级为管理层时，很少和下属沟通，或者弄得下属觉得整天被指手画脚工作地并不舒服；又或是一些下属主动沟通的能力基本没有，被动沟通时又表现出一副不屑或者不愿搭理的样子。前两天还看到有人说，技术很厉害的人凑在一起创业的多了，但是成功的就没有几个了，技术上的问题很容易解决，但是人的问题就没那么容易处理了。</p>
<p>这本书就是解决人的问题的，它提出了一些事例和七个步骤来说明如何带人：</p>
<blockquote>
<p>别再给员工讲道理了，没人听</p>
</blockquote>
<p>当出现问题时，首要需要想想如何解决问题，而不是陷入指责谁是导致问题的原因。</p>
<p>大部分情况下领导在出现问题时都是先追责，追责可以让导致出现问题的人记住教训避免其再犯，或者找出一个人来承担责任。但是书中指出这对问题的解决一点用处没有，而且很容易使人陷入一种负面的情绪中，大家变得沮丧、压抑、毫无斗志，我们应该在出现问题时，及时想办法补救。忘掉为什么，多问怎么办。</p>
<blockquote>
<p>如何听，员工才会说；如何说，员工才会听</p>
</blockquote>
<p>听，不要让自己的先入之见扭曲别人传递的信息。做到这点其实还挺不容易的，我们总是习惯在听人说话时，把自己放在一个更高的位置，认为自己有多么聪明，可以想到别人要表达什么，但是很多时候那只是我们的想法不是别人要说的，倾听时要对他人有耐心。</p>
<p>说，要用宽松而不是指令性的语言，采取邀请的姿态，而不是摆出指挥的架势。想到最近的女排，每次比赛切到郎平指导时，她都是以一种商量的口吻、建议的语气指出队员的问题（“XXX 刚才是不是 XXX 那样更好些？”)。又想到羽毛球，总指导说林丹是那种比较抗压的，可以指出他的问题说他逼他，但是谌龙就不能用这种方式，要用安抚的方式。大家都能接受宽松式的语言，但却有很多人不能接受指令性语言。</p>
<p>书名中提到的解决方案的七个步骤是：</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/08/31/Reading-The-Solution-Tango/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Alicia" />
          <p class="site-author-name" itemprop="name">Alicia</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2027344411/" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:alicialy@qq.com" target="_blank" title="mail">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  mail
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alicia</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/libs/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/libs/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/libs/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/libs/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/libs/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/libs/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
